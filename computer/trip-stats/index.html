<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Trip Computer</title>
  <meta name="description" content="Trip Computer">
  <meta name="author" content="Kevin Hinds">
  <link rel="stylesheet" href="style.css">
  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
    <div id="wrap">
            <h1 style="margin-bottom:10px;"><span id="time">--</span></h1> 
            <span style="padding-left: 80px;">
                <h3 style="color:#FFD5BB;"><span id="outsideTemp">--</span>&deg;F / <span id="outsideHumidity">--</span>%</h3>
                <h3 style="color:#CDD9F2;">[In <span id="insideTemp">--</span>&deg;F / <span id="insideHumidity">--</span>%]</h3> 
            </span>
            <table style="width:100%;">
                  <tr>
                    <td>
                        <h3><br/>
                            Heading: <span style="color: #FFF4AD;"><span id="tracking">--</span></span> <br/>
                            <img id="compass"/><br/>
                            <div style="color: #7C8FB3; ">Alt. <span id="altitude">--</span> ft</div>
                            <div style="color: #92B37C;">Speed <span id="speed">--</span> mph</div>            
                        </h3>
                    </td>
                    <td>
                    <table id="current-trip-info">
                      <tr>
                        <td>Driving</th>
                        <td><span style="color:#FFF4AD;"><span id="drivingTime">--</span></th>
                      </tr>
                      <!--tr>
                        <td>Miles</td>
                        <td><span style="color:#BBEDFF;"><span id="currentTripTime">--</span></span></td>
                      </tr-->
                      <tr>
                        <td>Traffic</td>
                        <td><span style="color:#FFD5BB;"><span id="inTrafficTime">--</span></span></td>
                      </tr>
                      <tr>
                        <td>Speed(avg)</td>
                        <td><span style="color:#92B37C;"><span id="averageSpeed">--</span> mph</span></td>
                      </tr>
                     <tr>
                        <td colspan='2'><br/><span id="weatherNextHour" style="color: #999; font-size: 25px;">--</span></td>
                      </tr>
                    </table>
                    </td>
                  </tr>
            </table>
            <span style="color: #FFF4AD; float:right; text-align:right;"><div id="phoneMessage"></div></span>
            
        <!-- weather info to be mapped to the hardware button -->            
        <div id="weather-stats-info" style="display:none;">
            <img id="weatherIcon"/>
            <span id="weatherSummary">--</span> - <span id="windSpeed">--</span> mph<br/>
            Precip: <span id="precipProbability">--</span>% - Intensity: <span id="precipIntensity">--</span><br/><br/>
           <br/><br/>
            <span id="localeInfo">--</span><br/>
            <br/><br/>
        </div> 
        
        <!-- trip status to be mapped to the hardware button -->
        <div id="trip-stats-table" style="display:none;">
            
            <table style="width:100%; display:none;">
              <tr>
                <th>Statistics</th>
                <th style="text-align: left; color: #999;">Today</th>
                <th style="text-align: left; color: #999;">Week</th>
                <th style="text-align: left; color: #999;">Month</th>
              </tr>
              <tr>
                <td>Driving</td>
                <td><span id="drivingTimes1">--</span></td>
                <td><span id="drivingTimes2">--</span></td>
                <td><span id="drivingTimes3">--</span></td>
              </tr>
              <tr>
                <td>Traffic</td>
                <td><span id="inTrafficTimes1">--</span></td>
                <td><span id="inTrafficTimes2">--</span></td>
                <td><span id="inTrafficTimes3">--</span></td>
              </tr>
              <tr>
                <td>Speed (avg)</td>
                <td><span id="averageSpeeds1">--</span> mph</td>
                <td><span id="averageSpeeds2">--</span> mph</td>
                <td><span id="averageSpeeds3">--</span> mph</td>
              </tr>
              <tr>
                <td>Miles</td>
                <td><span id="milesTravelled1">--</span></td>
                <td><span id="milesTravelled2">--</span></td>
                <td><span id="milesTravelled3">--</span></td>
              </tr>
              <tr>
                <td>Alt (avg)</td>
                <td><span id="averageAltitude1">--</span> ft</td>
                <td><span id="averageAltitude2">--</span> ft</td>
                <td><span id="averageAltitude3">--</span> ft</td>
              </tr>
            </table>
        </div>
        
    </div>

  <script src="jquery.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){
          setInterval(function(){
            $.get( "/computer/TripStats.py", function( data ) {
                var data = JSON.parse(data);
                console.log(data);
                
                // populate all the fields with data
                $( "#time" ).html( data.time );
                $( "#outsideTemp" ).html( data.outsideTemp );
                $( "#insideHumidity" ).html( data.insideHumidity );            
                $( "#insideTemp" ).html( data.insideTemp );
                $( "#localeInfo" ).html( data.localeInfo );
                $( "#outsideHumidity" ).html( data.outsideHumidity );
                $( "#precipIntensity" ).html( data.precipIntensity );
                $( "#precipProbability" ).html( data.precipProbability );
                $( "#tracking" ).html( data.tracking );
                $( "#compass" ).attr('src', '/computer/trip-stats/img/compass/' + data.tracking + '.png'  );

                $( "#weatherNextHour" ).html( data.weatherNextHour.substring(0, 30) );
                $( "#weatherSummary" ).html( data.weatherSummary );
                $( "#weatherIcon" ).attr('src', '/computer/trip-stats/img/weather/' + data.icon + '.png'  );                
                $( "#windSpeed" ).html( data.windSpeed );
                $( "#altitude" ).html( data.altitude );
                $( "#speed" ).html( data.speed );
                
                // current trip stats
                $( "#averageSpeed" ).html( data.averageSpeed );
                $( "#drivingTime" ).html( data.drivingTime );
                $( "#inTrafficTime" ).html( data.inTrafficTime );
                $( "#currentTripTime" ).html( data.tripMilesTravelled ); 
                 
                // populate altitude history
                $( "#averageAltitude1" ).html( data.averageAltitude[1] );
                $( "#averageAltitude2" ).html( data.averageAltitude[2] );
                $( "#averageAltitude3" ).html( data.averageAltitude[3] );
            
                // populate speed history
                $( "#averageSpeeds1" ).html( data.averageSpeeds[1] );
                $( "#averageSpeeds2" ).html( data.averageSpeeds[2] );            
                $( "#averageSpeeds3" ).html( data.averageSpeeds[3] );
                
                // populate driving times
                $( "#drivingTimes1" ).html( data.drivingTimes[1] );
                $( "#drivingTimes2" ).html( data.drivingTimes[2] );
                $( "#drivingTimes3" ).html( data.drivingTimes[3] );

                // populate traffic times
                $( "#inTrafficTimes1" ).html( data.inTrafficTimes[1] );
                $( "#inTrafficTimes2" ).html( data.inTrafficTimes[2] );
                $( "#inTrafficTimes3" ).html( data.inTrafficTimes[3] );
                
                // populate miles travelled
                $( "#milesTravelled1" ).html( data.milesTravelled[1] );
                $( "#milesTravelled2" ).html( data.milesTravelled[2] );
                $( "#milesTravelled3" ).html( data.milesTravelled[3] );
                
                // show phone message if one is present
                if (data.phoneMessage != '') {
                    $( "#phoneMessage" ).html( "<span style='color:#729fcf;'>Phone Message</span> <br/>" + data.phoneMessage );                
                } else {
                    $( "#phoneMessage" ).html( "" );                
                }
            });
          }, 1000);
      });
  </script>
</body>
</html>
